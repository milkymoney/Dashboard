openapi: 3.0.0
info:
  title: milkymoney
  description: 奶牛挣闲钱系统分析与设计
  version: 0.0.0

paths:
  /task:
    get:
      summary: 查询已发布任务列表
      parameters: 
        - in: query
          name: page
          schema:
            type: integer
          description: 任务列表的第几页
          required: true
        - in: query
          name: labels
          schema:
            $ref: '#/components/schemas/Labels'
          description: 筛选的标签列表，每一条记录是一条标签，标签格式为“key:value”
      responses:
        '200':
          description: 返回符合条件的已发布任务列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Task'
    post:
      summary: 发布任务
      description: 用户发送发布任务的请求
      requestBody:
        description: 发送待发布的任务
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/Task'
      responses:
        '200':
          description: 服务器正常返回
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 描述发布是否成功
                  id: 
                    type: integer
                    description: 已发布任务的id
                  message:
                    type: string
                    description: 描述错误信息
          
  /task/{taskId}:
    get:
      summary: 查询指定id的任务
      parameters: 
        - $ref: '#/components/parameters/taskId'
      responses:
        '200':
          description: 返回被查询的任务
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 表示是否有指定id的任务
                  task:
                    $ref: '#/components/schemas/Task'
        
  /task/{taskId}/accept:
    parameters: 
      - $ref: '#/components/parameters/taskId'
    post:
      summary: 接受任务
      requestBody:
        description: 发送待发布的任务
        required: true
        content:
          application/json:
            schema:
              allOf:
                - type: object
                  properties:
                    userId:
                      type: integer
                      description: 接受者id
      responses:
        '200':
          description: 服务器返回结果
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 描述是否成功接受
                  message:
                    type: string
                    description: 描述错误信息
  
  /task/{taskId}/settleup:
    parameters: 
      - $ref: '#/components/parameters/taskId'
    get:
      summary: 接受者查询自己已完成任务的信息
      description: 接受者完成任务的信息以及证明只有发布者和接受者自身才能看见
      responses:
        '200':
          description: 服务器返回自己提交的完成证明
          content:
            application/json:
              schema:
                type: object
                properties:
                  prove:
                    $ref: '#/components/schemas/prove'
                description: 已完成的用户及他们的信息和完成证明
        '400':
          description: 试图尝试访问不是自己完成的任务信息
    post:
      summary: 执行者结算任务
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - type: object
                  properties:
                    userId:
                      type: integer
                      description: 接受者id
                - $ref: '#/components/schemas/prove'
      responses:
        '200':
          description: 服务器返回结果
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 描述是否成功结算
                  message:
                    type: string
                    description: 描述错误信息
    
  /task/{taskId}/confirm:
    parameters: 
      - $ref: '#/components/parameters/taskId'
    get:
      summary: 发布者查询用户完成任务的所有信息
      description: 接受者完成任务的信息以及证明只有发布者才能看见,返回所有完成的信息
      responses:
        '200':
          description: 服务器返回已完成的用户信息以及完成证明
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    user:
                      $ref: '#/components/schemas/User'
                    prove:
                      $ref: '#/components/schemas/prove'
                description: 已完成的用户及他们的信息和完成证明
        '400':
          description: 试图尝试访问不是自己发布的任务信息
    put:
      summary: 发布者结算任务
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                confirm:
                  type: boolean
                  description: 发布者确认任务是否完成
      responses:
        '200':
          description: 服务器返回结果
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 描述是否成功结算
                  message:
                    type: string
                    description: 描述错误信息
  
  /user:
    get:
      summary: 查询用户信息
      responses:
        '200':
          description: 返回用户信息
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
  
  /login:
    post:
      summary: 登录
      requestBody:
        content:
          application/json:
            schema:
              type: string
              description: wx.login()得到的code
      responses:
        '200':
          description: 返回自定义登录态（openid）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/openid'
      
components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        balance:
          type: integer
    Task:
      type: object
      properties:
        tid:
          description: 任务id
          type: integer
        type:
          description: 任务类型
          type: string
          enum: 
            - 跑腿
            - 问卷
        description:
          description: 任务描述
          type: string
        reward:
          description: 任务报酬
          type: integer
        deadline:
          description: 任务DDL
          type: string
        labels:
          $ref: '#/components/schemas/Labels'
        state:
          type: string
          description: 任务的状态
          enum:
            - opened
            - closed
        priority:
          description: 任务优先级
          type: integer
        maxAccept:
          description: 最大接受人数
          type: integer
        hasAccept:
          description: 已接受人数
          type: integer
    Labels:
      type: string
      description: 标签列表，两个标签之间用空格分割，标签数不超过3个，单个标签长度不超过3
      example: 
        - '紧急 重酬'
        - '实验室 标数据 AI'
      
    prove:
      type: object
      properties:
        prove:
          type: string
          description: 证明的图片，转换成string
        format:
          type: string
          description: 证明图片的图片格式
          enum:
            - jpg
            - jpeg
            - png
            - gif
 
    openid:
      type: object
      properties:
        openid:
          description: 微信提供认证openId
          type: string
  
  parameters: 
    taskId:
      in: path
      name: taskId
      schema:
        type: integer
      required: true
      description: 任务id